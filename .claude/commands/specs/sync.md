---
allowed-tools: Read, Write, Glob, Grep, Bash(pnpm:*)
description: Orchestrate full phase initialization by running /plan, /explain, and /tests in sequence
---

# Phase Synchronization (/sync)

**Version:** 1.0
**Date:** December 2025
**Purpose:** Orchestrate full phase initialization by running /plan, /explain, and /tests in sequence

Meta-command that automates the full setup for a project phase - generating all standard planning, documentation, and QA artifacts in one operation.

---

## Usage

```bash
/sync P07-ai-foundation
/sync P07-ai-foundation/requirements.md
/sync P07-ai-foundation --skip-tests
/sync P07-ai-foundation --dry-run
```

### Flags

| Flag | Description | Default |
|------|-------------|---------|
| `--dry-run` | Preview what would be generated | false |
| `--skip-tests` | Skip test-plan.md generation | false |
| `--skip-explain` | Skip explanation.md generation | false |
| `--force` | Overwrite existing files | false |

---

## What /sync Generates

| Artifact | Generated By | Purpose |
|----------|--------------|---------|
| `task-breakdown.md` | `/plan` | Task structure, dependencies, estimates |
| `explanation.md` | `/explain` | Requirements summary, rationale, context |
| `test-plan.md` | `/tests` | Test categories, FR mappings, acceptance criteria |
| `meta.json` | `/sync` | Links all artifacts, tracks sync status |

---

## Process

### Step 1: Locate Input Context

```
If phase folder provided (P07-ai-foundation):
  → Look for .atzentis/specs/P07-ai-foundation/requirements.md
  
If requirements file provided:
  → Use directly
  
If task ID provided (T07-001):
  → Extract phase, locate requirements
```

### Step 2: Run /plan

Generate or update task breakdown:

```bash
/plan P07-ai-foundation/requirements.md
```

**Output:** `.atzentis/specs/P07-ai-foundation/task-breakdown.md`

**Contains:**
- Task summary table
- Dependency graph
- Critical path analysis
- Parallel execution strategy
- Resource allocation

### Step 3: Run /explain

Generate explanation document:

```bash
/explain P07-ai-foundation/requirements.md
```

**Output:** `.atzentis/specs/P07-ai-foundation/explanation.md`

**Contains:**
- Requirements summary
- Architecture decisions
- Integration points
- Rationale and context
- Key considerations

### Step 4: Run /tests

Generate test plan:

```bash
/tests P07-ai-foundation/requirements.md
```

**Output:** `.atzentis/specs/P07-ai-foundation/test-plan.md`

**Contains:**
- Test categories and tools
- FR → Test mappings
- Test file structure
- Acceptance criteria
- CI integration

### Step 5: Generate meta.json

Create metadata file for specs browser and tooling:

```json
{
  "phase": "P07-ai-foundation",
  "phaseName": "AI Foundation",
  "phaseNumber": 7,
  "description": "AI service integration with multi-provider support",
  "artifacts": {
    "requirements": "requirements.md",
    "taskBreakdown": "task-breakdown.md",
    "explanation": "explanation.md",
    "testPlan": "test-plan.md"
  },
  "tasks": [
    {
      "id": "T07-001",
      "name": "ai-core-setup",
      "title": "AI Core Setup",
      "estimate": 24,
      "status": "not_started",
      "subtasks": {
        "total": 5,
        "completed": 0
      }
    },
    {
      "id": "T07-002",
      "name": "chat-completion",
      "title": "Chat Completion",
      "estimate": 20,
      "status": "not_started",
      "subtasks": {
        "total": 5,
        "completed": 0
      }
    }
  ],
  "stats": {
    "totalTasks": 8,
    "completedTasks": 0,
    "inProgressTasks": 0,
    "totalSubtasks": 42,
    "completedSubtasks": 0,
    "totalEstimate": 140,
    "completedEstimate": 0,
    "progressPercent": 0
  },
  "coverage": {
    "frToTask": null,
    "taskToTest": null,
    "overall": null,
    "lastAudited": null
  },
  "generated": {
    "requirements": "2025-12-21T14:00:00Z",
    "taskBreakdown": "2025-12-21T15:30:00Z",
    "explanation": "2025-12-21T15:31:00Z",
    "testPlan": "2025-12-21T15:32:00Z"
  },
  "lastSynced": "2025-12-21T15:32:00Z",
  "status": "synced",
  "version": "1.0"
}
```

**Fields explained:**

| Field | Purpose | Updated By |
|-------|---------|------------|
| `phase` | Phase ID | /sync |
| `phaseName` | Human-readable name | /sync |
| `phaseNumber` | Numeric for sorting | /sync |
| `description` | Brief description | /sync (from requirements) |
| `artifacts` | Links to generated files | /sync |
| `tasks` | List of tasks with status | /sync, /status, /verify |
| `stats` | Aggregate statistics | /sync, /status, /verify |
| `coverage` | Audit results | /audit |
| `generated` | Timestamps per artifact | /sync |
| `lastSynced` | Last /sync run | /sync |
| `status` | Phase status | /sync, /status |

**Status values:**
- `synced` - All artifacts generated
- `partial` - Some artifacts missing
- `outdated` - Requirements changed since last sync
- `in_progress` - Implementation started
- `complete` - All tasks done

### Step 6: Verify Completeness

Check all required files exist and are valid:

- [ ] requirements.md exists and has FRs
- [ ] task-breakdown.md exists and has tasks
- [ ] explanation.md exists and has content
- [ ] test-plan.md exists and has test mappings
- [ ] All files are non-empty
- [ ] No placeholder sections

---

## Directory Structure (Post-Execution)

```
.atzentis/
├── specs/
│   └── P07-ai-foundation/
│       ├── requirements.md        ← Input (already exists)
│       ├── task-breakdown.md      ← Generated by /plan
│       ├── explanation.md         ← Generated by /explain
│       ├── test-plan.md           ← Generated by /tests
│       ├── meta.json              ← Generated by /sync
│       └── T07-001-ai-core-setup/
│           └── tasks.md           ← Generated by /specify (separate)
└── commands/
    └── sync.md
```

---

## Output Format

```
═══════════════════════════════════════════════════════════════════
  SYNC: P07 - AI Foundation
═══════════════════════════════════════════════════════════════════

Phase: P07-ai-foundation
Source: .atzentis/specs/P07-ai-foundation/requirements.md

───────────────────────────────────────────────────────────────────
STEP 1: Running /plan
───────────────────────────────────────────────────────────────────

Reading requirements.md...
  Found: 15 Functional Requirements
  Found: 8 User Stories
  Found: 12 Business Rules

Generating task-breakdown.md...
  Created: 8 tasks
  Total estimate: 140 hours
  Dependencies mapped: 12

✅ Generated: task-breakdown.md

───────────────────────────────────────────────────────────────────
STEP 2: Running /explain
───────────────────────────────────────────────────────────────────

Analyzing requirements and architecture...
  Phase purpose: AI service integration
  Key decisions: 4
  Integration points: 3

✅ Generated: explanation.md

───────────────────────────────────────────────────────────────────
STEP 3: Running /tests
───────────────────────────────────────────────────────────────────

Mapping requirements to tests...
  FR → Test mappings: 15
  Test categories: 6
  Acceptance criteria: 24

✅ Generated: test-plan.md

───────────────────────────────────────────────────────────────────
STEP 4: Creating meta.json
───────────────────────────────────────────────────────────────────

Linking artifacts...
✅ Created: meta.json

───────────────────────────────────────────────────────────────────
VERIFICATION
───────────────────────────────────────────────────────────────────

  ✅ requirements.md (15 FRs)
  ✅ task-breakdown.md (8 tasks)
  ✅ explanation.md (4 sections)
  ✅ test-plan.md (15 test mappings)
  ✅ meta.json (all artifacts linked)

═══════════════════════════════════════════════════════════════════
  ✅ Phase P07-ai-foundation fully synced
═══════════════════════════════════════════════════════════════════

Next steps:
  /specify P07-ai-foundation/requirements.md --all  → Generate tasks.md files
  /audit P07-ai-foundation                          → Validate coverage
```

---

## Dry Run Output

```bash
/sync P07-ai-foundation --dry-run
```

```
DRY RUN - No files will be created

Would generate:
  .atzentis/specs/P07-ai-foundation/task-breakdown.md
  .atzentis/specs/P07-ai-foundation/explanation.md
  .atzentis/specs/P07-ai-foundation/test-plan.md
  .atzentis/specs/P07-ai-foundation/meta.json

Source: requirements.md
  15 Functional Requirements detected
  8 User Stories detected

Run without --dry-run to generate files.
```

---

## Error Handling

### Missing Requirements File

```
❌ Error: requirements.md not found

Expected: .atzentis/specs/P07-ai-foundation/requirements.md

Create requirements.md first, then run /sync again.
```

### Low Confidence

```
⚠️ Low confidence detected in /plan step

Issues:
  - 3 FRs have unclear acceptance criteria
  - 2 User Stories missing estimates

Options:
  1. Continue anyway (may produce incomplete output)
  2. Cancel and clarify requirements first

Continue? [y/N]
```

### Partial Failure

```
⚠️ Partial sync completed

  ✅ task-breakdown.md generated
  ✅ explanation.md generated
  ❌ test-plan.md failed (missing test mappings)

Run `/tests P07-ai-foundation` manually after fixing issues.
```

---

## Integration with Other Commands

| Command | Relationship |
|---------|-------------|
| `/plan` | Called by /sync to generate task-breakdown.md |
| `/explain` | Called by /sync to generate explanation.md |
| `/tests` | Called by /sync to generate test-plan.md |
| `/specify` | Run AFTER /sync to generate individual tasks.md |
| `/audit` | Run AFTER /sync to validate coverage |
| `/review` | Validates spec format (can run before or after) |

### Recommended Workflow

```
requirements.md (written manually)
      ↓
   /sync         → task-breakdown.md, explanation.md, test-plan.md
      ↓
   /audit        → Validate FR → Task → Test coverage
      ↓
   /specify --all → Generate all tasks.md files
      ↓
   /review       → Validate spec format
      ↓
   /implement    → Build features
```

---

## Re-running /sync

`/sync` can be safely re-run:

- **Without --force:** Only generates missing files, skips existing
- **With --force:** Regenerates all files, overwrites existing

```bash
# Only generate missing files
/sync P07-ai-foundation

# Regenerate everything
/sync P07-ai-foundation --force
```

---

## Notes

- `/sync` is for **phase initialization** - run once at the start of a phase
- Always have `requirements.md` ready before running `/sync`
- Use `/audit` after `/sync` to validate coverage
- Use `/review` to validate spec format compliance
- Individual `tasks.md` files are created by `/specify`, not `/sync`
- Re-run with `--force` if requirements change significantly

---

**Document Version:** 1.0
**Last Updated:** December 2025